<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gravata Digital Ultimate ‚Äî Julia & Carlos</title>
    <meta name="description" content="Sistema completo de contribui√ß√£o para casamento com sorteio autom√°tico e presente digital exclusivo"/>
    <style>
        :root {
            --bg: #0b0c10;
            --card: #111319;
            --soft: #151826;
            --muted: #9aa4b2;
            --text: #e6e9ef;
            --brand: #18a57b;
            --brand-2: #23d8a0;
            --danger: #ff4d4f;
            --warning: #ff9800;
            --ok: #22c55e;
            --gold: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --accent: #4facfe;
            --pix: #32BCAD;
            --glass: rgba(255, 255, 255, 0.08);
            --radius: 18px;
            --radius-sm: 12px;
            --shadow: 0 20px 60px rgba(0,0,0,.35);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow-x: hidden;
        }

        body {
            background: linear-gradient(120deg, #0a0c12, #0f1220 45%, #0b0c10);
            color: var(--text);
            font: 16px/1.6 -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            position: relative;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            overflow: hidden;
            pointer-events: none;
        }

        .floating-element {
            position: absolute;
            font-size: 20px;
            animation: float 15s infinite linear;
            opacity: 0.15;
        }

        @keyframes float {
            from {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.15;
            }
            90% {
                opacity: 0.15;
            }
            to {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Container & Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 28px;
        }

        .grid {
            display: grid;
            gap: 20px;
        }

        .split {
            display: grid;
            gap: 20px;
            grid-template-columns: 1.2fr 0.8fr;
        }

        @media (max-width: 980px) {
            .split {
                grid-template-columns: 1fr;
            }
        }

        /* Glass Card */
        .card {
            background: linear-gradient(180deg, rgba(18, 22, 37, 0.95), rgba(11, 13, 22, 0.95));
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 24px;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Hero Section */
        .hero {
            position: relative;
            border-radius: 24px;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            margin-bottom: 30px;
        }

        .hero-bg {
            position: absolute;
            inset: 0;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 400"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop stop-color="%23667eea" offset="0" opacity="0.1"/><stop stop-color="%23764ba2" offset="1" opacity="0.1"/></linearGradient></defs><rect width="1200" height="400" fill="url(%23g)"/></svg>');
            filter: blur(60px);
            opacity: 0.5;
        }

        .hero-content {
            position: relative;
            padding: 48px 28px;
            text-align: center;
        }

        /* Typography */
        h1 {
            font-size: 42px;
            line-height: 1.1;
            margin: 10px 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 40px rgba(102, 126, 234, 0.3);
        }

        h2 {
            font-size: 28px;
            margin-bottom: 20px;
            color: var(--text);
        }

        h3 {
            font-size: 20px;
            margin-bottom: 15px;
            color: var(--text);
        }

        .lead {
            color: #c7d0dc;
            max-width: 65ch;
            margin: 0 auto 30px;
            font-size: 18px;
        }

        .muted {
            color: var(--muted);
        }

        .small {
            font-size: 13px;
        }

        /* Forms */
        .label {
            display: block;
            color: #aeb7c4;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .input, .select, .textarea {
            width: 100%;
            background: rgba(15, 19, 32, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            color: var(--text);
            padding: 14px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .input:focus, .select:focus, .textarea:focus {
            outline: none;
            border-color: var(--accent);
            background: rgba(15, 19, 32, 0.95);
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        /* Buttons */
        .btn {
            appearance: none;
            border: 0;
            border-radius: 14px;
            padding: 14px 24px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: var(--brand);
            color: white;
            box-shadow: 0 8px 24px rgba(24, 165, 123, 0.3);
        }

        .btn-ghost {
            background: transparent;
            color: var(--text);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-ghost:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .btn-muted {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-gold {
            background: var(--gold);
            color: #333;
            box-shadow: 0 8px 24px rgba(255, 215, 0, 0.3);
            animation: goldPulse 2s infinite;
        }

        @keyframes goldPulse {
            0%, 100% {
                box-shadow: 0 8px 24px rgba(255, 215, 0, 0.3);
            }
            50% {
                box-shadow: 0 8px 32px rgba(255, 215, 0, 0.5);
            }
        }

        .btn:active {
            transform: translateY(0) scale(0.98);
        }

        /* Value Selection */
        .amounts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .chip {
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            padding: 16px;
            text-align: center;
            background: rgba(15, 19, 32, 0.5);
            transition: all 0.3s;
            font-weight: 600;
        }

        .chip:hover {
            background: rgba(15, 19, 32, 0.8);
            transform: translateY(-2px);
        }

        .chip.active {
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.2), rgba(0, 242, 254, 0.2));
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(79, 172, 254, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(79, 172, 254, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(79, 172, 254, 0);
            }
        }

        /* Payment Methods */
        .payment-methods {
            display: flex;
            gap: 12px;
            margin: 20px 0;
        }

        .payment-method {
            flex: 1;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .payment-method:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .payment-method.active {
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(0, 242, 254, 0.1));
        }

        /* Pills & Badges */
        .pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            border: 1px solid rgba(102, 126, 234, 0.3);
            color: #aef7df;
            padding: 10px 16px;
            border-radius: 999px;
            font-size: 14px;
            margin: 5px;
        }

        .badge {
            display: inline-flex;
            gap: 6px;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 999px;
            padding: 6px 12px;
            color: var(--text);
            font-size: 12px;
        }

        /* Dashboard KPIs */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.05) 0%, transparent 70%);
            animation: kpiPulse 4s ease-in-out infinite;
        }

        @keyframes kpiPulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.5;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.3;
            }
        }

        .kpi-label {
            color: var(--muted);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .kpi-value {
            font-size: 28px;
            font-weight: 800;
            color: var(--text);
        }

        .kpi-change {
            font-size: 12px;
            color: var(--ok);
            margin-top: 5px;
        }

        /* Ranking */
        .ranking-list {
            list-style: none;
            padding: 0;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-sm);
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .ranking-item:hover {
            background: rgba(255, 255, 255, 0.06);
            transform: translateX(5px);
        }

        .ranking-item.top-1 {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 140, 0, 0.1));
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .ranking-position {
            font-size: 20px;
            font-weight: bold;
            color: var(--muted);
            min-width: 30px;
        }

        .ranking-name {
            flex: 1;
            font-weight: 600;
        }

        /* Table */
        .table-container {
            max-height: 400px;
            overflow: auto;
            border-radius: var(--radius-sm);
        }

        .table-row {
            display: grid;
            grid-template-columns: 1.5fr 1fr 0.8fr 0.5fr;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
        }

        .table-row:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        /* Success Screen */
        .success-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #43e97b, #38f9d7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 40px;
            animation: scaleIn 0.5s ease-out;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0);
            }
            to {
                transform: scale(1);
            }
        }

        .code-display {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: var(--radius);
            padding: 30px;
            text-align: center;
            margin: 20px 0;
        }

        .code-display .code {
            font-size: 32px;
            font-weight: 800;
            letter-spacing: 2px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 16px 24px;
            border-radius: var(--radius-sm);
            display: none;
            animation: toastIn 0.3s ease-out;
            z-index: 1000;
            max-width: 350px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .toast.show {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        @keyframes toastIn {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Loading */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .loading.active {
            display: flex;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Utilities */
        .row {
            display: flex;
            flex-wrap: wrap;
            gap: 14px;
        }

        .center {
            text-align: center;
        }

        .hr {
            border: none;
            border-top: 1px dashed rgba(255, 255, 255, 0.1);
            margin: 20px 0;
        }

        section {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 32px;
            }
            
            .kpi-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .amounts {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .table-row {
                grid-template-columns: 1fr;
                gap: 8px;
            }
        }

        /* PWA Ready */
        @media (display-mode: standalone) {
            body {
                padding-top: env(safe-area-inset-top);
            }
        }

        /* Accessibility */
        *:focus-visible {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        /* Print Styles */
        @media print {
            body {
                background: white;
                color: black;
            }
            
            .btn, .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Background Animation -->
    <div class="bg-animation" id="bgAnimation"></div>

    <!-- Hero Section -->
    <header class="hero container card">
        <div class="hero-bg"></div>
                    <div class="hero-content">
            <div class="row center" style="justify-content: center;">
                <span class="badge">üíç <span id="couple-names">Julia & Carlos</span></span>
                <span class="badge">üìÖ <span id="wedding-date-display">15/03/2025</span></span>
                <span class="badge">üìç <span id="wedding-venue-display">Igreja S√£o Jos√© ‚Ä¢ RJ</span></span>
            </div>
            <h1>Gravata Digital Premium</h1>
            <p class="lead">
                Contribua para nossa lua de mel dos sonhos e concorra a um presente digital exclusivo! 
                Sistema seguro, transparente e com sorteio autom√°tico na festa.
            </p>
            <div class="row center" style="justify-content: center;">
                <button class="btn btn-primary" onclick="App.go('contribuir')">
                    üíù Contribuir Agora
                </button>
                <button class="btn btn-gold" onclick="App.go('resgatar')">
                    üéÅ Resgatar Presente
                </button>
                <button class="btn btn-ghost" onclick="App.go('ranking')">
                    üèÜ Ver Ranking
                </button>
                <button class="btn btn-muted" onclick="App.go('admin')">
                    ‚öôÔ∏è Painel Admin
                </button>
            </div>
            <div class="row center" style="justify-content: center; margin-top: 20px;">
                <span class="pill">‚ú® QR Code na mesa</span>
                <span class="pill">üîí Pagamento Seguro</span>
                <span class="pill">üé≤ Sorteio Autom√°tico</span>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- CONTRIBUIR -->
        <section id="view-contribuir" class="card" hidden>
            <h2>üíù Contribua com a Gravata Digital</h2>
            <p class="muted">
                Preencha seus dados e escolha o valor. Voc√™ automaticamente concorre ao presente digital exclusivo!
            </p>
            
            <div class="split">
                <div>
                    <form id="contributionForm">
                        <div class="row">
                            <div style="flex: 1;">
                                <label class="label" for="nome">Nome completo*</label>
                                <input id="nome" name="nome" class="input" placeholder="Seu nome completo" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div style="flex: 0.3;">
                                <label class="label" for="countryCode">C√≥digo Pa√≠s</label>
                                <select id="countryCode" class="select">
                                    <option value="55">üáßüá∑ +55</option>
                                    <option value="1">üá∫üá∏ +1</option>
                                    <option value="351">üáµüáπ +351</option>
                                    <option value="34">üá™üá∏ +34</option>
                                    <option value="33">üá´üá∑ +33</option>
                                    <option value="49">üá©üá™ +49</option>
                                    <option value="39">üáÆüáπ +39</option>
                                    <option value="44">üá¨üáß +44</option>
                                    <option value="54">üá¶üá∑ +54</option>
                                    <option value="56">üá®üá± +56</option>
                                    <option value="57">üá®üá¥ +57</option>
                                    <option value="52">üá≤üáΩ +52</option>
                                </select>
                            </div>
                            <div style="flex: 0.7;">
                                <label class="label" for="fone">WhatsApp*</label>
                                <input id="fone" name="fone" class="input" placeholder="(21) 99999-9999" required>
                            </div>
                            <div style="flex: 1;">
                                <label class="label" for="email">E-mail*</label>
                                <input id="email" name="email" class="input" type="email" placeholder="seu@email.com" required>
                            </div>
                        </div>

                        <div class="hr"></div>

                        <label class="label">Escolha o valor da contribui√ß√£o</label>
                        <div id="amounts" class="amounts"></div>
                        
                        <div class="row">
                            <div style="flex: 2;">
                                <label class="label" for="custom">Ou digite outro valor (R$)</label>
                                <input id="custom" class="input" type="number" min="10" step="10" placeholder="Digite o valor">
                            </div>
                            <div style="flex: 1; align-self: flex-end;">
                                <button type="button" class="btn btn-ghost" onclick="UI.selectCustom()">
                                    Usar este valor
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <div>
                    <div class="card">
                        <h3>üí≥ Forma de Pagamento</h3>
                        <p class="muted small">Escolha como prefere pagar. Processamento seguro e instant√¢neo.</p>
                        
                        <div class="payment-methods">
                            <div class="payment-method" onclick="Pay.select('pix')">
                                <div style="font-size: 32px;">üì±</div>
                                <div>PIX</div>
                            </div>
                            <div class="payment-method" onclick="Pay.select('card')">
                                <div style="font-size: 32px;">üí≥</div>
                                <div>Cart√£o</div>
                            </div>
                            <div class="payment-method" onclick="Pay.select('mp')">
                                <div style="font-size: 32px;">üí∞</div>
                                <div>Mercado Pago</div>
                            </div>
                        </div>
                        
                        <div id="pay-ui" style="margin-top: 20px;"></div>
                        
                        <div class="row" style="justify-content: flex-end; margin-top: 20px;">
                            <button class="btn btn-success" onclick="Flow.checkout()">
                                ‚úÖ Finalizar Pagamento
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- PAYMENT CONFIRMATION -->
        <section id="view-payment-confirmation" class="card center" hidden>
            <h2>‚è≥ Confirmando Pagamento...</h2>
            <div class="spinner" style="margin: 30px auto;"></div>
            <p class="muted">
                Aguardando confirma√ß√£o do pagamento para liberar seu c√≥digo de participa√ß√£o.
            </p>
            <div class="card" style="margin-top: 20px;">
                <h3>Status do Pagamento</h3>
                <div id="payment-status" class="badge" style="font-size: 16px; padding: 15px;">
                    üîÑ Processando...
                </div>
                <p class="small muted" style="margin-top: 15px;">
                    Isso pode levar alguns segundos. Por favor, aguarde.
                </p>
            </div>
            <button class="btn btn-ghost" onclick="Flow.checkPaymentStatus()" style="margin-top: 20px;">
                üîÑ Verificar Status
            </button>
        </section>

        <!-- SUCESSO -->
        <section id="view-sucesso" class="card center" hidden>
            <div class="success-icon">‚úì</div>
            <h2>Pagamento Confirmado! üéâ</h2>
            <p class="muted">
                Sua contribui√ß√£o foi processada com sucesso. 
                Voc√™ est√° participando do sorteio do presente digital exclusivo!
            </p>
            
            <div class="code-display">
                <p class="muted">Seu c√≥digo de participa√ß√£o</p>
                <div class="code" id="ticket">GD-XXXXX</div>
                <p class="small muted">Guarde este c√≥digo. Ele ser√° usado no sorteio!</p>
            </div>
            
            <div class="row center" style="justify-content: center;">
                <button class="btn btn-primary" onclick="Flow.shareWhats()">
                    üì± Receber por WhatsApp
                </button>
                <button class="btn btn-ghost" onclick="Flow.copyCode()">
                    üìã Copiar C√≥digo
                </button>
                <button class="btn btn-muted" onclick="App.go('home')">
                    üè† Voltar ao In√≠cio
                </button>
            </div>
        </section>

        <!-- RANKING -->
        <section id="view-ranking" class="card" hidden>
            <h2>üèÜ Ranking de Contribui√ß√µes</h2>
            <p class="muted">
                Top 10 contribuidores da Gravata Digital. 
                <strong>Valores n√£o s√£o exibidos para preservar a privacidade.</strong>
            </p>
            
            <ol class="ranking-list" id="rankingList">
                <!-- Populated dynamically -->
            </ol>
            
            <div class="row" style="justify-content: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="App.go('contribuir')">
                    Fazer Contribui√ß√£o
                </button>
                <button class="btn btn-ghost" onclick="App.go('home')">
                    Voltar ao In√≠cio
                </button>
            </div>
        </section>

        <!-- RESGATAR PRESENTE -->
        <section id="view-resgatar" class="card" hidden>
            <h2>üéÅ Resgatar Presente Digital</h2>
            <p class="muted">
                Se voc√™ foi o vencedor do sorteio, insira o c√≥digo exclusivo recebido via WhatsApp/E-mail.
            </p>
            
            <div class="row">
                <input id="redeem-code" class="input" placeholder="Digite o c√≥digo de resgate" style="flex: 2;">
                <button class="btn btn-gold" onclick="Gift.redeem()" style="flex: 1;">
                    üîì Desbloquear Presente
                </button>
            </div>
            
            <div id="gift-ui" class="card" style="margin-top: 20px; display: none;">
                <h3>üéâ Parab√©ns! Presente Desbloqueado!</h3>
                <p id="gift-desc" class="muted"></p>
                <div class="row">
                    <a id="gift-link" class="btn btn-primary" href="#" target="_blank">
                        üéÅ Acessar Presente
                    </a>
                    <button class="btn btn-ghost" onclick="Gift.copyAccess()">
                        üìã Copiar Link
                    </button>
                </div>
                <div id="gift-password" class="badge" style="margin-top: 15px; display: none;">
                    Senha: <strong id="gift-pass-text"></strong>
                </div>
            </div>
        </section>

        <!-- ADMIN -->
        <section id="view-admin" class="card" hidden>
            <h2>‚öôÔ∏è Painel Administrativo</h2>
            
            <div class="card">
                <h3>üîê Autentica√ß√£o</h3>
                <div class="row">
                    <input id="admin-pass" class="input" type="password" placeholder="Senha de administrador" style="flex: 1;">
                    <button class="btn btn-primary" onclick="Admin.auth()">
                        Entrar
                    </button>
                </div>
            </div>

            <div id="admin-ui" style="display: none;">
                <!-- KPIs Dashboard -->
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-label">Total de Contribui√ß√µes</div>
                        <div class="kpi-value" id="kpi-count">0</div>
                        <div class="kpi-change">‚Üë Atualizado agora</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">Total Arrecadado</div>
                        <div class="kpi-value" id="kpi-sum">R$ 0,00</div>
                        <div class="kpi-change">‚Üë Meta: R$ 10.000</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">Ticket M√©dio</div>
                        <div class="kpi-value" id="kpi-avg">R$ 0,00</div>
                        <div class="kpi-change">Por contribuidor</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">√öltima Contribui√ß√£o</div>
                        <div class="kpi-value" id="kpi-last">‚Äî</div>
                        <div class="kpi-change" id="kpi-last-time">‚Äî</div>
                    </div>
                </div>

                <div class="split">
                    <!-- Configuration Panel -->
                    <div>
                        <div class="card">
                            <h3>üí∞ Configura√ß√£o de Recebimento</h3>
                            <label class="label">Chave PIX</label>
                            <input id="set-pix" class="input" placeholder="email@exemplo.com ou CPF/CNPJ">
                            
                            <label class="label" style="margin-top: 15px;">Dados Banc√°rios (opcional)</label>
                            <div class="row">
                                <input id="set-bank" class="input" placeholder="Banco" style="flex: 1;">
                                <input id="set-agency" class="input" placeholder="Ag√™ncia" style="flex: 0.5;">
                                <input id="set-account" class="input" placeholder="Conta" style="flex: 1;">
                            </div>
                            
                            <label class="label" style="margin-top: 15px;">Gateway de Pagamento</label>
                            <select id="set-gateway" class="select">
                                <option value="demo">Modo Demonstra√ß√£o</option>
                                <option value="stripe">Stripe</option>
                                <option value="mercadopago">Mercado Pago</option>
                                <option value="pagseguro">PagSeguro</option>
                            </select>
                            
                            <div class="row" style="justify-content: flex-end; margin-top: 20px;">
                                <button class="btn btn-success" onclick="Admin.savePayout()">
                                    üíæ Salvar Configura√ß√µes
                                </button>
                            </div>
                        </div>

                        <div class="card" style="margin-top: 20px;">
                            <h3>üíí Configurar Evento</h3>
                            <div class="row">
                                <div style="flex: 1;">
                                    <label class="label">Nome do Noivo</label>
                                    <input id="groom-name" class="input" placeholder="Nome do noivo">
                                </div>
                                <div style="flex: 1;">
                                    <label class="label">Nome da Noiva</label>
                                    <input id="bride-name" class="input" placeholder="Nome da noiva">
                                </div>
                            </div>
                            
                            <div class="row" style="margin-top: 15px;">
                                <div style="flex: 1;">
                                    <label class="label">Data do Casamento</label>
                                    <input id="wedding-date" class="input" type="date">
                                </div>
                                <div style="flex: 1;">
                                    <label class="label">Hor√°rio</label>
                                    <input id="wedding-time" class="input" type="time">
                                </div>
                            </div>
                            
                            <label class="label" style="margin-top: 15px;">Local do Evento</label>
                            <input id="wedding-venue" class="input" placeholder="Ex: Igreja S√£o Jos√© ‚Ä¢ Rio de Janeiro">
                            
                            <div class="row" style="justify-content: flex-end; margin-top: 20px;">
                                <button class="btn btn-success" onclick="Admin.saveEventInfo()">
                                    üíæ Salvar Informa√ß√µes do Evento
                                </button>
                            </div>
                        </div>

                        <div class="card" style="margin-top: 20px;">
                            <h3>üéÅ Configurar Presente Digital</h3>
                            <label class="label">T√≠tulo do Presente</label>
                            <input id="gift-title" class="input" placeholder="Ex: √Ålbum Digital Exclusivo">
                            
                            <label class="label" style="margin-top: 15px;">Descri√ß√£o</label>
                            <textarea id="gift-desc-input" class="input" rows="3" placeholder="Descreva o presente digital..."></textarea>
                            
                            <label class="label" style="margin-top: 15px;">Link do Presente</label>
                            <input id="gift-link-input" class="input" placeholder="https://...">
                            
                            <label class="label" style="margin-top: 15px;">Senha de Acesso (opcional)</label>
                            <input id="gift-pass-input" class="input" placeholder="Senha para acessar o presente">
                            
                            <div class="row" style="justify-content: flex-end; margin-top: 20px;">
                                <button class="btn btn-success" onclick="Admin.saveGift()">
                                    üíæ Salvar Presente
                                </button>
                            </div>
                        </div>

                        <div class="card" style="margin-top: 20px;">
                            <h3>üé≤ Configurar Sorteio</h3>
                            <div class="row">
                                <div style="flex: 1;">
                                    <label class="label">Hor√°rio do Sorteio</label>
                                    <input id="raffle-time" class="input" type="time" value="23:00">
                                </div>
                                <div style="flex: 1;">
                                    <label class="label">M√©todo de Sorteio</label>
                                    <select id="raffle-weight" class="select">
                                        <option value="flat">Chances Iguais</option>
                                        <option value="weighted">Proporcional ao Valor</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row" style="justify-content: flex-end; margin-top: 20px;">
                                <button class="btn btn-primary" onclick="Admin.scheduleRaffle()">
                                    ‚è∞ Agendar Sorteio
                                </button>
                                <button class="btn btn-gold" onclick="Admin.runRaffleNow()">
                                    üé≤ Sortear Agora
                                </button>
                            </div>
                            
                            <div id="winner-display" class="card" style="margin-top: 20px; display: none;">
                                <h3>üèÜ Vencedor do Sorteio</h3>
                                <div class="badge" style="font-size: 18px; padding: 15px;">
                                    <strong id="winner-name">‚Äî</strong>
                                </div>
                                <p class="small muted">C√≥digo: <strong id="winner-code">‚Äî</strong></p>
                            </div>
                        </div>
                    </div>

                    <!-- Data Panel -->
                    <div>
                        <div class="card">
                            <h3>üìä √öltimas Contribui√ß√µes</h3>
                            <div class="table-container" id="contributions-table">
                                <!-- Populated dynamically -->
                            </div>
                            
                            <div class="row" style="justify-content: flex-end; margin-top: 20px;">
                                <button class="btn btn-ghost" onclick="Admin.exportCSV()">
                                    üì• Exportar CSV
                                </button>
                                <button class="btn btn-danger" onclick="Admin.resetAll()">
                                    üóëÔ∏è Limpar Dados
                                </button>
                            </div>
                        </div>
                        
                        <div class="card" style="margin-top: 20px;">
                            <h3>üèÜ Top 10 Contribuidores</h3>
                            <ol id="admin-ranking" class="ranking-list">
                                <!-- Populated dynamically -->
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="container center" style="opacity: 0.7; padding: 40px 20px;">
        <p class="small">
            ¬© 2025 A&R ‚Ä¢ Gravata Digital Ultimate ‚Ä¢ Desenvolvido por OMG
        </p>
        <p class="small">
            LGPD: Seus dados s√£o protegidos e usados apenas para o sorteio. 
            Sistema 100% seguro e transparente.
        </p>
    </footer>

    <!-- Loading Overlay -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script>
    // Configuration
    const CONFIG = {
        DEMO_MODE: true,
        DEFAULT_AMOUNTS: [25, 50, 100, 150, 200, 300, 500, 1000],
        CURRENCY: 'BRL',
        ADMIN_PASSWORD: 'admin2025', // Change in production
        STORAGE_KEYS: {
            DATA: 'gravata:contributions',
            ADMIN: 'gravata:admin',
            GIFT: 'gravata:gift',
            PAYOUT: 'gravata:payout',
            RAFFLE: 'gravata:raffle',
            WINNER: 'gravata:winner',
            EVENT: 'gravata:event',
            PENDING: 'gravata:pending'
        }
    };

    // Utilities
    const Utils = {
        formatMoney(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: CONFIG.CURRENCY
            }).format(value);
        },
        
        formatPhone(phone) {
            const clean = phone.replace(/\D/g, '');
            if (clean.length === 11) {
                return clean.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            }
            return phone;
        },
        
        generateCode(prefix = 'GD') {
            const random = Math.random().toString(36).substring(2, 7).toUpperCase();
            const timestamp = Date.now().toString(36).substring(-3).toUpperCase();
            return `${prefix}-${random}${timestamp}`;
        },
        
        showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), duration);
        },
        
        showLoading(show = true) {
            document.getElementById('loading').classList.toggle('active', show);
        },
        
        validateEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        },
        
        validatePhone(phone) {
            const clean = phone.replace(/\D/g, '');
            return clean.length >= 10 && clean.length <= 11;
        }
    };

    // Storage
    const Storage = {
        get(key) {
            try {
                return JSON.parse(localStorage.getItem(key)) || null;
            } catch {
                return null;
            }
        },
        
        set(key, value) {
            localStorage.setItem(key, JSON.stringify(value));
        },
        
        push(key, item) {
            const data = Storage.get(key) || [];
            data.push(item);
            Storage.set(key, data);
            return data;
        },
        
        clear(key) {
            localStorage.removeItem(key);
        }
    };

    // Main App
    const App = {
        currentView: null,
        
        init() {
            this.initBackground();
            this.loadEventInfo();
            UI.mountAmounts();
            Admin.checkAuth();
            this.bindEvents();
        },
        
        initBackground() {
            const bg = document.getElementById('bgAnimation');
            const elements = ['üíï', 'üíù', '‚ú®', 'üíé', 'üíç', 'üéÅ'];
            
            for (let i = 0; i < 20; i++) {
                const el = document.createElement('div');
                el.className = 'floating-element';
                el.textContent = elements[Math.floor(Math.random() * elements.length)];
                el.style.left = Math.random() * 100 + '%';
                el.style.animationDelay = Math.random() * 15 + 's';
                el.style.animationDuration = (15 + Math.random() * 10) + 's';
                bg.appendChild(el);
            }
        },
        
        loadEventInfo() {
            const event = Storage.get(CONFIG.STORAGE_KEYS.EVENT) || {
                groomName: 'Carlos',
                brideName: 'Julia',
                date: '2025-03-15',
                time: '18:00',
                venue: 'Igreja S√£o Jos√© ‚Ä¢ RJ'
            };
            
            // Update display
            document.getElementById('couple-names').textContent = `${event.brideName} & ${event.groomName}`;
            
            if (event.date) {
                const date = new Date(event.date + 'T12:00:00');
                document.getElementById('wedding-date-display').textContent = 
                    date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });
            }
            
            document.getElementById('wedding-venue-display').textContent = event.venue || 'Local a definir';
        },
        
        bindEvents() {
            // Form submission
            const form = document.getElementById('contributionForm');
            if (form) {
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    Flow.checkout();
                });
            }
        },
        
        go(view) {
            // Hide all sections
            document.querySelectorAll('section').forEach(s => s.hidden = true);
            
            if (view === 'home') {
                window.scrollTo(0, 0);
                this.currentView = null;
                return;
            }
            
            const section = document.getElementById(`view-${view}`);
            if (section) {
                section.hidden = false;
                section.scrollIntoView({ behavior: 'smooth' });
                this.currentView = view;
                
                // Update specific views
                if (view === 'admin') Admin.sync();
                if (view === 'ranking') UI.updatePublicRanking();
            }
        }
    };

    // UI Management
    const UI = {
        selectedAmount: null,
        
        mountAmounts() {
            const container = document.getElementById('amounts');
            if (!container) return;
            
            container.innerHTML = '';
            CONFIG.DEFAULT_AMOUNTS.forEach(value => {
                const chip = document.createElement('button');
                chip.className = 'chip';
                chip.type = 'button';
                chip.textContent = Utils.formatMoney(value);
                chip.onclick = () => this.selectAmount(value, chip);
                container.appendChild(chip);
            });
        },
        
        selectAmount(value, element) {
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            element.classList.add('active');
            this.selectedAmount = value;
            document.getElementById('custom').value = '';
        },
        
        selectCustom() {
            const value = parseFloat(document.getElementById('custom').value);
            if (!value || value < 10) {
                Utils.showToast('Digite um valor m√≠nimo de R$ 10');
                return;
            }
            
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            this.selectedAmount = value;
            Utils.showToast(`Valor selecionado: ${Utils.formatMoney(value)}`);
        },
        
        updatePublicRanking() {
            const contributions = Storage.get(CONFIG.STORAGE_KEYS.DATA) || [];
            const ranking = this.calculateRanking(contributions);
            
            const container = document.getElementById('rankingList');
            if (!container) return;
            
            if (ranking.length === 0) {
                container.innerHTML = '<li class="ranking-item">Nenhuma contribui√ß√£o ainda</li>';
                return;
            }
            
            container.innerHTML = ranking.slice(0, 10).map((item, index) => `
                <li class="ranking-item ${index === 0 ? 'top-1' : ''}">
                    <span class="ranking-position">${index === 0 ? 'üèÜ' : '#' + (index + 1)}</span>
                    <span class="ranking-name">${item.name}</span>
                    <span class="badge">${item.count} contribui√ß√£o(√µes)</span>
                </li>
            `).join('');
        },
        
        calculateRanking(contributions) {
            const grouped = {};
            contributions.forEach(c => {
                if (!grouped[c.nome]) {
                    grouped[c.nome] = { name: c.nome, total: 0, count: 0 };
                }
                grouped[c.nome].total += c.valor;
                grouped[c.nome].count++;
            });
            
            return Object.values(grouped).sort((a, b) => b.total - a.total);
        }
    };

    // Payment Processing
    const Pay = {
        method: null,
        
        select(type) {
            this.method = type;
            
            // Update UI
            document.querySelectorAll('.payment-method').forEach(m => 
                m.classList.remove('active')
            );
            event.target.closest('.payment-method').classList.add('active');
            
            const container = document.getElementById('pay-ui');
            const payout = Storage.get(CONFIG.STORAGE_KEYS.PAYOUT) || {};
            
            switch(type) {
                case 'pix':
                    container.innerHTML = `
                        <div class="card">
                            <h4>PIX - Pagamento Instant√¢neo</h4>
                            <p class="muted small">Chave PIX:</p>
                            <div class="badge" style="font-size: 14px; padding: 10px;">
                                ${payout.pix || 'casamento@exemplo.com'}
                            </div>
                            <button class="btn btn-ghost" onclick="Pay.copyPix()" style="margin-top: 10px;">
                                üìã Copiar Chave
                            </button>
                        </div>
                    `;
                    break;
                    
                case 'card':
                    container.innerHTML = `
                        <div class="card">
                            <h4>Pagamento com Cart√£o</h4>
                            <div class="row">
                                <input class="input" placeholder="N√∫mero do cart√£o" style="flex: 2;">
                                <input class="input" placeholder="MM/AA" style="flex: 1;">
                                <input class="input" placeholder="CVV" style="flex: 1;">
                            </div>
                            <p class="small muted">Modo demo - pagamento simulado</p>
                        </div>
                    `;
                    break;
                    
                case 'mp':
                    container.innerHTML = `
                        <div class="card">
                            <h4>Mercado Pago</h4>
                            <p class="muted">Voc√™ ser√° redirecionado para o Mercado Pago</p>
                            <p class="small muted">Modo demo - pagamento simulado</p>
                        </div>
                    `;
                    break;
            }
        },
        
        copyPix() {
            const payout = Storage.get(CONFIG.STORAGE_KEYS.PAYOUT) || {};
            const pix = payout.pix || 'casamento@exemplo.com';
            navigator.clipboard.writeText(pix);
            Utils.showToast('Chave PIX copiada!');
        }
    };

    // Flow Management
    const Flow = {
        lastTransaction: null,
        pendingTransaction: null,
        
        checkout() {
            const nome = document.getElementById('nome').value.trim();
            const fone = document.getElementById('fone').value.trim();
            const email = document.getElementById('email').value.trim();
            const countryCode = document.getElementById('countryCode').value;
            const valor = UI.selectedAmount;
            
            // Validation
            if (!nome || !fone || !email) {
                Utils.showToast('Por favor, preencha todos os campos');
                return;
            }
            
            if (!Utils.validatePhone(fone)) {
                Utils.showToast('Telefone inv√°lido');
                return;
            }
            
            if (!Utils.validateEmail(email)) {
                Utils.showToast('E-mail inv√°lido');
                return;
            }
            
            if (!valor || valor < 10) {
                Utils.showToast('Selecione um valor m√≠nimo de R$ 10');
                return;
            }
            
            if (!Pay.method) {
                Utils.showToast('Selecione uma forma de pagamento');
                return;
            }
            
            // Create pending transaction
            this.pendingTransaction = {
                id: Utils.generateCode(),
                nome,
                fone: Utils.formatPhone(fone),
                countryCode,
                fullPhone: `+${countryCode}${fone.replace(/\D/g, '')}`,
                email,
                valor,
                metodo: Pay.method,
                timestamp: Date.now(),
                status: 'pending'
            };
            
            // Save to pending
            Storage.push(CONFIG.STORAGE_KEYS.PENDING, this.pendingTransaction);
            
            // Show payment confirmation screen
            App.go('payment-confirmation');
            
            // Simulate payment processing
            this.processPayment();
        },
        
        processPayment() {
            // Simulate payment verification (in production, this would check with actual gateway)
            setTimeout(() => {
                const randomSuccess = Math.random() > 0.1; // 90% success rate for demo
                
                if (randomSuccess || CONFIG.DEMO_MODE) {
                    this.confirmPayment();
                } else {
                    this.paymentFailed();
                }
            }, 3000);
        },
        
        confirmPayment() {
            if (!this.pendingTransaction) return;
            
            // Update status
            this.pendingTransaction.status = 'approved';
            this.lastTransaction = this.pendingTransaction;
            
            // Save confirmed transaction
            Storage.push(CONFIG.STORAGE_KEYS.DATA, this.lastTransaction);
            
            // Remove from pending
            const pending = Storage.get(CONFIG.STORAGE_KEYS.PENDING) || [];
            const filtered = pending.filter(t => t.id !== this.lastTransaction.id);
            Storage.set(CONFIG.STORAGE_KEYS.PENDING, filtered);
            
            // Update UI
            document.getElementById('payment-status').innerHTML = '‚úÖ Pagamento Confirmado!';
            document.getElementById('ticket').textContent = this.lastTransaction.id;
            
            // Clear form
            document.getElementById('contributionForm').reset();
            UI.selectedAmount = null;
            Pay.method = null;
            document.querySelectorAll('.chip, .payment-method').forEach(el => 
                el.classList.remove('active')
            );
            
            // Show success after delay
            setTimeout(() => {
                Utils.showToast('C√≥digo liberado com sucesso!');
                App.go('sucesso');
                
                // Update admin stats if logged in
                if (Admin.isAuthenticated) {
                    Admin.sync();
                }
            }, 1500);
        },
        
        paymentFailed() {
            document.getElementById('payment-status').innerHTML = '‚ùå Pagamento n√£o confirmado';
            Utils.showToast('Pagamento n√£o confirmado. Tente novamente.');
            
            setTimeout(() => {
                App.go('contribuir');
            }, 2000);
        },
        
        checkPaymentStatus() {
            Utils.showToast('Verificando status...');
            this.processPayment();
        },
        
        shareWhats() {
            if (!this.lastTransaction) return;
            
            const t = this.lastTransaction;
            const event = Storage.get(CONFIG.STORAGE_KEYS.EVENT) || {};
            const coupleNames = `${event.brideName || 'Julia'} & ${event.groomName || 'Carlos'}`;
            
            const message = `Ol√° ${t.nome}! üéâ\n\nSua contribui√ß√£o para a Gravata Digital foi confirmada!\n\nC√≥digo de participa√ß√£o: *${t.id}*\n\nGuarde este c√≥digo para o sorteio do presente digital exclusivo!\n\nMuito obrigado pelo carinho! üíï\n\n${coupleNames}`;
            
            const phone = t.fullPhone || `+${t.countryCode}${t.fone.replace(/\D/g, '')}`;
            const url = `https://wa.me/${phone.replace('+', '')}?text=${encodeURIComponent(message)}`;
            
            window.open(url, '_blank');
        },
        
        copyCode() {
            const code = document.getElementById('ticket').textContent;
            navigator.clipboard.writeText(code);
            Utils.showToast('C√≥digo copiado!');
        }
    };

    // Gift Management
    const Gift = {
        redeem() {
            const code = document.getElementById('redeem-code').value.trim().toUpperCase();
            if (!code) {
                Utils.showToast('Digite o c√≥digo de resgate');
                return;
            }
            
            const winner = Storage.get(CONFIG.STORAGE_KEYS.WINNER);
            const gift = Storage.get(CONFIG.STORAGE_KEYS.GIFT) || {};
            
            if (!winner || winner.code !== code) {
                Utils.showToast('C√≥digo inv√°lido ou expirado');
                return;
            }
            
            // Show gift
            document.getElementById('gift-desc').textContent = gift.desc || 'Presente digital exclusivo dos noivos';
            document.getElementById('gift-link').href = gift.link || '#';
            
            if (gift.pass) {
                document.getElementById('gift-password').style.display = 'inline-flex';
                document.getElementById('gift-pass-text').textContent = gift.pass;
            }
            
            document.getElementById('gift-ui').style.display = 'block';
            Utils.showToast('Presente desbloqueado com sucesso! üéÅ');
        },
        
        copyAccess() {
            const gift = Storage.get(CONFIG.STORAGE_KEYS.GIFT) || {};
            let text = gift.link || '';
            if (gift.pass) {
                text += `\nSenha: ${gift.pass}`;
            }
            navigator.clipboard.writeText(text);
            Utils.showToast('Informa√ß√µes copiadas!');
        }
    };

    // Admin Panel
    const Admin = {
        isAuthenticated: false,
        
        checkAuth() {
            const savedPass = Storage.get(CONFIG.STORAGE_KEYS.ADMIN);
            this.isAuthenticated = savedPass === CONFIG.ADMIN_PASSWORD;
        },
        
        auth() {
            const pass = document.getElementById('admin-pass').value;
            if (pass === CONFIG.ADMIN_PASSWORD) {
                Storage.set(CONFIG.STORAGE_KEYS.ADMIN, pass);
                this.isAuthenticated = true;
                this.sync();
                Utils.showToast('Acesso autorizado!');
                document.getElementById('admin-pass').value = '';
            } else {
                Utils.showToast('Senha incorreta');
            }
        },
        
        sync() {
            const ui = document.getElementById('admin-ui');
            ui.style.display = this.isAuthenticated ? 'block' : 'none';
            
            if (!this.isAuthenticated) return;
            
            // Load settings
            const payout = Storage.get(CONFIG.STORAGE_KEYS.PAYOUT) || {};
            const gift = Storage.get(CONFIG.STORAGE_KEYS.GIFT) || {};
            const raffle = Storage.get(CONFIG.STORAGE_KEYS.RAFFLE) || {};
            const event = Storage.get(CONFIG.STORAGE_KEYS.EVENT) || {};
            
            // Fill event info
            document.getElementById('groom-name').value = event.groomName || '';
            document.getElementById('bride-name').value = event.brideName || '';
            document.getElementById('wedding-date').value = event.date || '';
            document.getElementById('wedding-time').value = event.time || '';
            document.getElementById('wedding-venue').value = event.venue || '';
            
            // Fill payout
            document.getElementById('set-pix').value = payout.pix || '';
            document.getElementById('set-bank').value = payout.bank || '';
            document.getElementById('set-agency').value = payout.agency || '';
            document.getElementById('set-account').value = payout.account || '';
            document.getElementById('set-gateway').value = payout.gateway || 'demo';
            
            // Fill gift
            document.getElementById('gift-title').value = gift.title || '';
            document.getElementById('gift-desc-input').value = gift.desc || '';
            document.getElementById('gift-link-input').value = gift.link || '';
            document.getElementById('gift-pass-input').value = gift.pass || '';
            
            // Fill raffle
            document.getElementById('raffle-time').value = raffle.time || '23:00';
            document.getElementById('raffle-weight').value = raffle.weight || 'flat';
            
            // Update stats
            this.updateStats();
            this.updateTable();
            this.updateAdminRanking();
            this.updateWinner();
        },
        
        saveEventInfo() {
            const event = {
                groomName: document.getElementById('groom-name').value || 'Carlos',
                brideName: document.getElementById('bride-name').value || 'Julia',
                date: document.getElementById('wedding-date').value,
                time: document.getElementById('wedding-time').value,
                venue: document.getElementById('wedding-venue').value || 'Local a definir'
            };
            
            Storage.set(CONFIG.STORAGE_KEYS.EVENT, event);
            
            // Update display immediately
            App.loadEventInfo();
            
            Utils.showToast('Informa√ß√µes do evento atualizadas!');
        },
        
        updateStats() {
            const contributions = Storage.get(CONFIG.STORAGE_KEYS.DATA) || [];
            const total = contributions.reduce((sum, c) => sum + c.valor, 0);
            const avg = contributions.length > 0 ? total / contributions.length : 0;
            const last = contributions[contributions.length - 1];
            
            document.getElementById('kpi-count').textContent = contributions.length;
            document.getElementById('kpi-sum').textContent = Utils.formatMoney(total);
            document.getElementById('kpi-avg').textContent = Utils.formatMoney(avg);
            
            if (last) {
                document.getElementById('kpi-last').textContent = last.nome;
                document.getElementById('kpi-last-time').textContent = 
                    new Date(last.timestamp).toLocaleString('pt-BR');
            }
        },
        
        updateTable() {
            const contributions = Storage.get(CONFIG.STORAGE_KEYS.DATA) || [];
            const container = document.getElementById('contributions-table');
            
            if (contributions.length === 0) {
                container.innerHTML = '<p class="muted center">Nenhuma contribui√ß√£o ainda</p>';
                return;
            }
            
            container.innerHTML = contributions.slice(-10).reverse().map(c => `
                <div class="table-row">
                    <div>
                        <strong>${c.nome}</strong>
                        <div class="small muted">${c.email}</div>
                    </div>
                    <div>${c.countryCode ? '+' + c.countryCode + ' ' : ''}${Utils.formatPhone(c.fone)}</div>
                    <div><strong>${Utils.formatMoney(c.valor)}</strong></div>
                    <div class="badge">${c.metodo.toUpperCase()}</div>
                </div>
            `).join('');
        },
        
        updateAdminRanking() {
            const contributions = Storage.get(CONFIG.STORAGE_KEYS.DATA) || [];
            const ranking = UI.calculateRanking(contributions);
            const container = document.getElementById('admin-ranking');
            
            if (ranking.length === 0) {
                container.innerHTML = '<li>Nenhuma contribui√ß√£o ainda</li>';
                return;
            }
            
            container.innerHTML = ranking.slice(0, 10).map((item, index) => `
                <li class="ranking-item">
                    <span class="ranking-position">${index + 1}</span>
                    <span class="ranking-name">${item.name}</span>
                    <span class="badge">${Utils.formatMoney(item.total)}</span>
                </li>
            `).join('');
        },
        
        updateWinner() {
            const winner = Storage.get(CONFIG.STORAGE_KEYS.WINNER);
            if (winner) {
                document.getElementById('winner-display').style.display = 'block';
                document.getElementById('winner-name').textContent = winner.name;
                document.getElementById('winner-code').textContent = winner.code;
            }
        },
        
        savePayout() {
            const payout = {
                pix: document.getElementById('set-pix').value,
                bank: document.getElementById('set-bank').value,
                agency: document.getElementById('set-agency').value,
                account: document.getElementById('set-account').value,
                gateway: document.getElementById('set-gateway').value
            };
            
            Storage.set(CONFIG.STORAGE_KEYS.PAYOUT, payout);
            Utils.showToast('Configura√ß√µes de pagamento salvas!');
        },
        
        saveGift() {
            const gift = {
                title: document.getElementById('gift-title').value,
                desc: document.getElementById('gift-desc-input').value,
                link: document.getElementById('gift-link-input').value,
                pass: document.getElementById('gift-pass-input').value
            };
            
            Storage.set(CONFIG.STORAGE_KEYS.GIFT, gift);
            Utils.showToast('Presente digital configurado!');
        },
        
        scheduleRaffle() {
            const raffle = {
                time: document.getElementById('raffle-time').value,
                weight: document.getElementById('raffle-weight').value
            };
            
            Storage.set(CONFIG.STORAGE_KEYS.RAFFLE, raffle);
            Utils.showToast(`Sorteio agendado para ${raffle.time}`);
        },
        
        runRaffleNow() {
            const contributions = Storage.get(CONFIG.STORAGE_KEYS.DATA) || [];
            if (contributions.length === 0) {
                Utils.showToast('N√£o h√° contribui√ß√µes para sortear');
                return;
            }
            
            const raffle = Storage.get(CONFIG.STORAGE_KEYS.RAFFLE) || {};
            const event = Storage.get(CONFIG.STORAGE_KEYS.EVENT) || {};
            let pool = [];
            
            if (raffle.weight === 'weighted') {
                // Weighted by value
                contributions.forEach(c => {
                    const weight = Math.ceil(c.valor / 50);
                    for (let i = 0; i < weight; i++) {
                        pool.push(c);
                    }
                });
            } else {
                // Equal chances
                pool = contributions;
            }
            
            // Select winner
            const winner = pool[Math.floor(Math.random() * pool.length)];
            const winnerData = {
                name: winner.nome,
                email: winner.email,
                phone: winner.fullPhone || `+${winner.countryCode || '55'}${winner.fone.replace(/\D/g, '')}`,
                code: Utils.generateCode('GIFT'),
                timestamp: Date.now()
            };
            
            Storage.set(CONFIG.STORAGE_KEYS.WINNER, winnerData);
            this.updateWinner();
            
            // Show notification
            Utils.showToast(`üéâ Vencedor: ${winner.nome}!`);
            
            // Prepare WhatsApp message
            const coupleNames = `${event.brideName || 'Julia'} & ${event.groomName || 'Carlos'}`;
            const message = `Parab√©ns ${winner.nome}! üéâ\n\nVoc√™ ganhou o presente digital exclusivo!\n\nSeu c√≥digo de resgate: *${winnerData.code}*\n\nAcesse o site e use este c√≥digo para resgatar seu pr√™mio!\n\nCom carinho,\n${coupleNames} üíï`;
            
            const whatsUrl = `https://wa.me/${winnerData.phone.replace(/[^0-9]/g, '')}?text=${encodeURIComponent(message)}`;
            
            if (confirm(`Vencedor sorteado: ${winner.nome}\n\nDeseja enviar o c√≥digo via WhatsApp?`)) {
                window.open(whatsUrl, '_blank');
            }
        },
        
        exportCSV() {
            const contributions = Storage.get(CONFIG.STORAGE_KEYS.DATA) || [];
            if (contributions.length === 0) {
                Utils.showToast('N√£o h√° dados para exportar');
                return;
            }
            
            const csv = [
                'Nome,Telefone,CodigoPais,Email,Valor,Metodo,Data,Codigo,Status',
                ...contributions.map(c => 
                    `"${c.nome}","${c.fone}","${c.countryCode || '55'}","${c.email}",${c.valor},"${c.metodo}","${new Date(c.timestamp).toLocaleString('pt-BR')}","${c.id}","${c.status || 'approved'}"`
                )
            ].join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `gravata_digital_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            Utils.showToast('Dados exportados com sucesso!');
        },
        
        resetAll() {
            if (!confirm('Isso apagar√° TODOS os dados. Tem certeza?')) return;
            if (!confirm('Esta a√ß√£o √© IRREVERS√çVEL. Confirma?')) return;
            
            Object.values(CONFIG.STORAGE_KEYS).forEach(key => Storage.clear(key));
            Utils.showToast('Todos os dados foram apagados');
            setTimeout(() => location.reload(), 1500);
        }
    };

    // Initialize app when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => App.init());
    } else {
        App.init();
    }
    </script>
</body>
</html>
